!function(e,t,a){Date.prototype.format=function(e){var t={"M+":this.getMonth()+1,"d+":this.getDate(),"h+":this.getHours(),"m+":this.getMinutes(),"s+":this.getSeconds(),"q+":Math.floor((this.getMonth()+3)/3),S:this.getMilliseconds()};/(y+)/.test(e)&&(e=e.replace(RegExp.$1,(this.getFullYear()+"").substr(4-RegExp.$1.length)));for(var a in t)new RegExp("("+a+")").test(e)&&(e=e.replace(RegExp.$1,1==RegExp.$1.length?t[a]:("00"+t[a]).substr((""+t[a]).length)));return e},e.fn.serializeObject=function(){var t={};return e.each(this.serializeArray(),function(){this.value&&(void 0!==t[this.name]?(t[this.name].push||(t[this.name]=[t[this.name]]),t[this.name].push(this.value||"")):t[this.name]=this.value||"")}),t};var n=!1,o=function(e){var t;401!=e.status||n||(n=!0,(t=[]).push("登录状态异常，请重新登录。"),t.push(" 1. 您的登录状态已过期；"),t.push(" 2. 您的账号在其他地方登录；"),t.push(" 3. 网络异常。"),layer.closeAll(),u.alert(t.join("<br>"),p,{shadeClose:!1,closeBtn:0,icon:4,btn:"重新登录"}))};var r,i,s=function(t,a,r,i,s,c){if(n)return s&&s({status:401}),!1;var l={url:t,type:"post",dataType:"json",data:a,success:r,error:i,complete:s};if(c&&"object"==typeof c&&(l=e.extend(l,c)),l.complete){var u=l.complete;l.complete=function(){u.apply(this,arguments),o.apply(this,arguments)}}else l.complete=o;e.ajax(l)},c=function(e,t,a,n){l.show(),s(e,t,function(e){"200"==e.code?a&&a(e.data):u.alert(e.msg||"服务器开小差")},function(e){if(401!=e.status){var t="网络异常，请稍候再试";0==e.status&&(t="网络繁忙，请稍候重试"),t=[t,[e.status,e.statusText].join("-")].join("<br>"),u.alert(t,void 0,{icon:5})}},function(){l.hide(),n&&n()})},l={show:function(){r&&layer.close(r),r=layer.load(2,{shade:[.1,"black"]})},hide:function(){layer.close(r)}},u=function(){function t(t){e("#layui-layer"+t).find("a.layui-layer-btn0").attr("href","javascript:void(0)").focus()}return{confirm:function(a,n,o,r){var i={title:"系统提示",icon:3};r&&(i=e.extend(i,r)),t(layer.confirm(a,i,n,o))},alert:function(a,n,o){var r={title:"系统提示",icon:0,resize:!1,shadeClose:!0};o&&(r=e.extend(r,o)),t(layer.alert(a,r,n))},msg:function(t,a,n){var o,r={};n&&(r=e.extend(r,n)),o=layer.msg(t,r,a),e("#layui-layer"+o).find(".layui-layer-content").on("click",function(){layer.close(o)})}}}(),d=(i=["","2元","2角","2分","2厘","1元","1角","1分","1厘"],function(e){return i[e]});function f(e,t){var a,n,o,r=/(\d)(?=(?:\d{3})+$)/g,i=t||4;if(e=isNaN(e)?0:Number(Number(e).toFixed(4)),a=parseInt(e),o=e<0&&0==a,r.test(a)&&(a=(a+"").replace(r,"$1,")),i>(n=(n=String(e)).lastIndexOf(".")>0?n.substring(n.lastIndexOf(".")):".").length-1)do{n+="0"}while(i>n.length-1);else n=n.substring(0,i+1);return e=a+n,o&&(e="-"+e),e}function m(e){var t,a=/(\d)(?=(?:\d{3})+$)/g;return t=isNaN(e)?0:parseInt(Number(e).toFixed(4)),a.test(t)&&(t=(t+"").replace(a,"$1,")),t}t.registerTransform("formatComma",f),t.registerTransform("formatCommaInt",m);var h,p=function(){var e=location.pathname+location.search+location.hash;location.href="/login.html?for="+encodeURIComponent(e)},v=function(){var e=arguments.callee;s("/user/getUser.do",void 0,function(e){"200"==e.code?(t.set("user",e.data),setTimeout(g,15e3)):p()},function(){setTimeout(e,3e3)})},g=function(e){var a=arguments.callee;h&&clearTimeout(h),s("/user/getBalance.do",void 0,function(n){"200"==n.code?(t.set("user.balance",n.data),h=setTimeout(a,15e3),e&&e()):setTimeout(v,1e3)},function(){setTimeout(v,1e3)})},k=function(){var a,n,o;function r(){a&&clearTimeout(a),s("/redPacket/check.do",null,function(t){if(200==t.code){var a=e(".redPacket.link").length>0;t.data?!a&&e('<a class="redPacket link">').appendTo("body"):a&&e(".redPacket.link").remove()}},null,function(e){401!=e.status&&(a=setTimeout(r,5e3))})}function i(){var a={type:0};var n=e("#modal_redPacket"),o={money:"",num:"",target:"",targetGroup:"1",password:"",total:"0",title:"1"};t.set("redPacket",e.extend({},o)),t.watch("redPacket.money",function(e){3==a.type?t.set("redPacket.total",e*t.get("redPacket.num")):t.set("redPacket.total",e)}),t.watch("redPacket.num",function(e){3==a.type&&t.set("redPacket.total",e*t.get("redPacket.money"))}),n.find("input.int").on("input",function(){var e=this.value;/\D+/.test(e)&&(this.value=e.replace(/\D+/,""))}),n.find("input.double").on({input:function(){var e=this.value;/[^\d.]+/.test(e)&&(this.value=e.replace(/[^\d.]+/,""))},"blur change":function(){var e=this.value;e.length&&(e>1e3?this.value=1e3:e<.01&&(this.value=.01))}}),n.find(".modal-body .btn").on("click",function(){var n,o,r=e(this),i=r.data("id");a.type=i,r.parents(".form-group").siblings().hide().filter(".T"+i).show(),r.addClass("active").siblings(".active").removeClass("active"),n=t.get("redPacket")||{},isNaN(n.money)||(o=3==i?(n.num||"").length&&!isNaN(n.num)?n.money*n.num:"":n.money,t.set("redPacket.total",o))}).first().click(),n.find(".modal-footer .btn").on("click",function(){var r=t.get("redPacket")||{};if(!(r.total<=0)){if(1==a.type){if(!r.target)return void u.msg("请选择红包接收对象")}else{if(r.num<=0)return;if(!r.targetGroup)return void u.msg("请选择红包接收人群")}var i,s;i=function(){u.msg("发送成功！"),t.set("redPacket",e.extend({},o)),n.modal("hide")},s=t.get("redPacket")||{},c("/redPacket/send.do",{type:a.type,amount:s.total,pUserName:s.target,groupType:s.targetGroup,groupNumber:s.num,title:s.title,password:s.password},i)}}),e(".btnShowModal_redPacket").on("click",function(){e("#modal_redPacket").modal()}),s("/redPacket/getMyXiaji.do",null,function(t){if(200==t.code){var a=["<option></option>"];e.each(t.data,function(){a.push("<option>"+this+"</option>")}),e("#_mr_sT").html(a)}})}function d(){function t(t){if(0==t.length)return u.msg("当前没有可以领取的红包"),void e(".redPacket.link").remove();var a=e('<div class="redPacket panel">').appendTo("body");e('<a class="close"></a>').appendTo(a);var o=[];e.each(t,function(){var t=e('<a class="redAction"></a>');t.data("id",this.id),t.html(this.title).data("title",this.title),o.push(t)}),a.append(o);var r=["zoomIn","zoomInDown","zoomInUp"][Math.floor(3*Math.random())];!function(){n&&clearTimeout(n),o.length&&(n=setTimeout(arguments.callee,150));var t=o.shift();e(".redAction."+r).removeClass(r),t&&t.css("visibility","visible").addClass(r)}()}var a=e(document);a.on("click",".redPacket.link",function(){c("/redPacket/getMyRps.do",null,t)}),a.on("click",".redPacket.panel",function(t){/panel|close/.test(t.target.className)&&e(this).remove()}),a.on("click",".redPacket.panel>.redAction",function(){var t=e(this);t.addClass("active"),function(t){var a=t.data("id"),o=t.data("title"),r=e('<div class="redPacket panel">').appendTo("body");r.on("click",function(e){/panel|close/.test(e.target.className)&&t.removeClass("active")}),e('<a class="close"></a>').appendTo(r);var i=e('<div class="boxShow rotate3d"></div>').appendTo(r);i.html(o),l.show(),n&&clearTimeout(n),n=setTimeout(function(){s("/redPacket/open.do",{rpid:a},function(e){if(200==e.code){var a=[o,"<br><br>￥ <i>",f(e.data,2),"</i> 元"];i.addClass("success").html(a.join("")),1==(n=t.parent()).find(".redAction").length?n.remove():t.remove()}else{var n;2==e.code&&(1==(n=t.parent()).find(".redAction").length?n.remove():t.remove()),i.html(e.msg||"服务器开小差")}},function(e){if(401!=e.status){var t="网络异常，请稍候再试";0==e.status&&(t="网络繁忙，请稍候重试"),t=[t,[e.status,e.statusText].join("-")].join("<br>"),i.html(t)}},function(){i.removeClass("rotate3d"),l.hide()})},1e3)}(t)})}return function(){a&&clearTimeout(a),a=setTimeout(r,1e3),d(),i(),function(){var t=e(".rank_redPackets");if(0!=t.length){store.get("rankMin")&&t.addClass("min"),t.show();var a={formatComma:function(e){return f(e,2)}};!function(){var t=arguments.callee;o&&clearTimeout(o),s("/redPacket/queryRedPacketsRank.do",null,function(t){if(200==t.code){var n=template("_t_rank_redPackets",{list:t.data||[],formatComma:a.formatComma});e(".rank_redPackets .rankBox").html(n)}},null,function(){o=setTimeout(t,3e4)})}();var n=e(document),r=0,i=0;n.on("click",".rank_redPackets>.close",function(){var t=e(this).parent().toggleClass("min");store.set("rankMin",t.hasClass("min"))}),n.on("click",".rank_redPackets ul>li",function(){var t,a=e(this),n=a.index();a.addClass("active").siblings().removeClass("active"),a.parent().hasClass("type")?i=n:r=n,t=r+i+(i?1:0),e(".rank_redPackets .rankBox").removeClass("T0 T1 T2 T3").addClass("T"+t)})}}()}}();e(function(){if(0!=UnLoadTopRightSlider)return!1;k(),v();var t,n=e(document);t=function(){var t,a=0;function n(){e(".needscroll").niceScroll({cursorcolor:"#444",cursoropacitymax:1,touchbehavior:!1,cursorwidth:"6px",cursorborder:"0",cursorborderradius:"6px",autohidemode:!1,background:"#111"}),e(".bluescroll").niceScroll({cursorcolor:"#00c0ff",background:"#0e75bb",cursoropacitymax:1,touchbehavior:!0,cursorwidth:"6px",cursorborder:"0",cursorborderradius:"6px"})}return function(){var e=(new Date).getTime();if(e<a)return!1;a=e+500,t&&clearTimeout(t),t=setTimeout(n,500)}}(),/WebKit/gi.test(navigator.appVersion)||n.on("DOMSubtreeModified","body",t),function(){function t(){var t=store.get("msgUnread");t&&e(".unReadMsg").html(t).show()}t(),a.refreshUnRead=t}(),function(){var t,a=store.get("view_balance_status"),n=e(".user-amount-refresh");function o(){g(function(){setTimeout(function(){n.removeClass("loading")},500)})}n.on("click",function(){n.addClass("loading"),t&&clearTimeout(t),t=setTimeout(o,500)}),e(".btn_balance_toggle").on("click",function(){var t=e(this).parents("ul");t.toggleClass("show"),store.set("view_balance_status",t.hasClass("show"))}),0!=a&&n.parents("ul").addClass("show")}(),n.on("click",".btn_logout",function(){u.confirm("退出系统?",function(){l.show(),s("/login/logout.do",void 0,function(){store.clear(),location.href="/login.html"},function(){location.reload()})})}),e(".btnService").on("click",function(){window.open("/urls/customerurl.do")})}),function(){t.set("nowTime",(new Date).format("yyyy-MM-dd hh:mm:ss")),setTimeout(arguments.callee,1e3)}();var b={UnLoadTopRightSlider:!1,refreshBalance:g,getQueryString:function(e){var t=new RegExp("(^|&)"+e+"=([^&]*)(&|$)","i"),a=location.search.substr(1).match(t);return a?a[2]:""},formatCommaInt:m,formatComma:f,formatCode:function(e,t,a){var n=e||"";return n=n.replace(/&/g,","),t&&(n=(t=(t=(t=(t=(t=(t=t.replace(/,|&/g,"_")).replace("0","万")).replace("1","千")).replace("2","百")).replace("3","十")).replace("4","个"))+"|"+n),a&&n.length>a&&(n=n.substr(0,a)+"..."),n},LoadPlugin:l,formatYjf:d,doAjaxPack:c,doAjax:s,Modal:u};e.extend(a,b)}($,way,window);